<html>

<head>
    <title>
        Let's Talk
    </title>
    <link rel="stylesheet" type="text/css" href="css/bthere.css">
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/themes/smoothness/jquery-ui.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/jquery-ui.min.js"></script>
    <script type="text/javascript" charset="utf-8">
        document.addEventListener("deviceready", onDeviceReady, false);

        function onDeviceReady() {

            var list = [];
            var kills;
            list.push("11111");

            bluetoothle.initialize(initializeSuccess, initializeError, {
                "request": true,
                "statusReceiver": false
            });

            function initializeSuccess() {
           
            }

            function initializeError() {
     
            }

            function stopScanSuccess() {
                //var jsonString = JSON.stringify(list);
                var email = window.localStorage.getItem("BThereEmail");
                alert(list.length);
                $.ajax({
                    type: "POST",
                    url: "http://www.greenseedmusic.com/btherecheckin.php",
                    data: {
                        email: email,
                        locArr: list
                    },
                    success: function (data) {
                        alert(JSON.parse(data) +" PooP");
                    },
                    error: function (data) {
                        alert("error");
                    }
                });
            }

            function stopScanError() {
      
            }

            function startScanSuccess(obj) {
                myVar = setTimeout(function () {clearTimeout(kills);
                    bluetoothle.stopScan(stopScanSuccess, stopScanError)
                }, 6000);
                

                if (list.indexOf(obj.name) == -1) {
                    list.push(obj.name);
                }
            

            }

            function startScanError() {

            }

            document.getElementById("join").addEventListener("click", join);
            //CheckIn -- add the Event Listener.
            document.getElementById("checkin").addEventListener("click", checkin);

            if (window.localStorage.getItem("BThere") == "true") {


                var email = window.localStorage.getItem("BThereEmail");
                var password = window.localStorage.getItem("BTherePassword");

                $.ajax({
                    type: "POST",
                    async: "true",
                    url: "http://www.greenseedmusic.com/btherelogin.php",
                    data: {
                        email: email,
                        password: password
                    },
                    success: function (data) {
                        alert(data);
                        var buttons = document.getElementById("checkinsection");
                        buttons.style.display = "block";
                    },
                    error: function (data) {}
                });
            } else {

                var buttons = document.getElementById("buttons");
                buttons.style.display = "block";
            }



            $('#Signup').submit(function () {
                $.post('http://www.greenseedmusic.com/bthereinsert.php', $(this).serialize(), function (data) {
                    var email = $("#signupEmail").val();
                    var password = $("#signupPassword").val();
                    window.localStorage.setItem("BThere", "true");
                    window.localStorage.setItem("BThereEmail", email);
                    window.localStorage.setItem("BTherePassword", password);
                }).fail(function () {

                });
                return false;
            });

            function join() {
                var buttons = document.getElementById("buttons");
                buttons.style.display = "none";
                var buttons = document.getElementById("signupformsection");
                buttons.style.display = "block";

            }

            //This code will execute when the Check-In button is clicked.
            function checkin() {
                alert("Checkedin");
                     
                kills = setTimeout(function () {
                    bluetoothle.startScan(startScanSuccess, startScanError, {
                        "serviceUuids": []
                    });
                }, 500);

               

            }
        }
    </script>
</head>

<body>
    <!-- main button section -->
    <section id="buttons" style="margin-top:25%; height:50%; display:none;">
        <button class="button--large--cta" id="join">Join The Movement</button>
    </section>

    <!-- signup form section -->
    <section id="signupformsection" style="margin-top:25%; height:50%;display:none;">
        <form name="Signup" id="Signup" autocomplete="on">
            <!-- email -->
            <input type="email" class="text-input" placeholder="email" name="email" id="signupEmail">
            <!-- password -->
            <input type="text" class="text-input" placeholder="password" name="password" id="signupPassword">
            <!-- name -->
            <input type="text" class="text-input" placeholder="Name" name="name">
            <!-- nickname -->
            <input type="text" class="text-input" placeholder="Nick Name" name="nickname">
            <!-- Bio -->
            <textarea class="textarea--transparent" rows="3" placeholder="Biography" maxlength="50" name="bio"></textarea>
            <!-- Interesting Fact -->
            <input type="text" class="text-input" placeholder="Fun Fact" name="fact">
            <!-- Submit Button -->
            <input type="submit" class="button--large--cta" id="join" value="Sign In" />
        </form>
    </section>

    <!-- Check-In Button Section -->
    <section id="checkinsection" style="margin-top:25%; height:50%; display:none;">
        <button class="button--large--cta" id="checkin">Check In</button>
    </section>
</body>

</html>